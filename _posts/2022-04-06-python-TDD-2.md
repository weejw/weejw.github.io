---
layout: post
title: TDD(Test Driven Development) (2)
subtitle: Pythonì—ì„œ TDDë¡œ ì§„í–‰í•´ë³´ì. 
author: weejw
categories: python

tags: [tdd, python, development]
---

ë‚´ìš©ì´ ë§ì•„ì„œ ë¶„í• í•´ì„œ ì§„í–‰í•´ì•¼ê² ë‹¤ ;(

[https://testdriven.io/blog/modern-tdd/](https://testdriven.io/blog/modern-tdd/) ë¥¼ ì°¸ê³ í•˜ì—¬ ê³µë¶€í–ˆë‹¤. <br>
[ì´ì „ ê¸€](https://weejw.github.io/python/2022/03/29/python-TDD.html) <br>

ê²©ë¦¬ëŠ” í•´ì œë˜ì—ˆìœ¼ë‚˜, ì•„ì§ë„ ì½”ë¡œë‚˜ì˜ ì—¬íŒŒë¡œ ê¸°ì¹¨ê³¼ ë‘í†µì´ ìœ¼... ì–¼ë¥¸ ë‚˜ì•˜ìœ¼ë©´ ì¢‹ê² ë‹¤ ğŸ˜¥ <br>

> í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë”°ë¡œ ì•ˆ ë§Œë“¤ì–´ë„ ëœë‹¤ê³  ì£¼ì¥í•˜ëŠ” ê°œë°œìëŠ” ëŒ€ë‹¨íˆ ìê¸° ì¤‘ì‹¬ì ì´ê³  ì´ê¸°ì ì¸ ì‚¬ëŒì´ë‹¤ - ì†Œí”„íŠ¸ì›¨ì–´ ì¥ì¸ 

@pytest.fixture annotateë¥¼ ì‚¬ìš©í•˜ë©´ test í›„ì— ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì§€ìš°ê³  ê° í…ŒìŠ¤íŠ¸ ì „ì— ìƒˆ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤. <br>
ì•„ë˜ ì½”ë“œë¥¼ ë³´ë©´ ì¤‘ê°„ì— yieldê°€ ìˆë‹¤. ë³¸ë¬¸ì— ì˜í•˜ë©´ ì´ yield ì¼ ë•Œ í…ŒìŠ¤íŠ¸ê°€ ì§„í–‰ëœë‹¤. (ì•„ì§ ë¬´ìŠ¨ ë§ì¸ì§€ í¬ê²Œ ì™€ë‹¿ì§€ ì•ŠëŠ”ë‹¤..)
```python
@pytest.fixture(autouse=True)
def database():
    _, file_name = tempfile.mkstemp()
    os.environ["DATABASE_NAME"] = file_name
    Article.create_table(database_name=file_name)
    yield
```
```python
@pytest.fixture
def some_fixture():
    # do something before your test
    yield # test runs here
    # do something after your test
```

ìœ— ê¸€ë§Œìœ¼ë¡œëŠ” ì˜ ì´í•´ê°€ ì•ˆê°€ì„œ ì¢€ ë” ì°¾ì•„ë³´ì•˜ë‹¤. <br>
@pytest.fixture decorate ë¥¼ ì‚¬ìš©í•˜ë©´ fixture ì„ ì–¸í•œ í•¨ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ì—ì„œ ì¸ìë¡œ ë„£ì–´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ê³  í•œë‹¤. <br>


### Fixtureê°€ ë­˜ê¹Œ?
- í…ŒìŠ¤íŠ¸ë¥¼ ìë™í™”í•˜ê±°ë‚˜ ì¡°ì ˆí•˜ê¸° ìœ„í•´ ì‚¬ìš©ë¨
- í…ŒìŠ¤íŠ¸ ì‹œ í•„ìš”í•œ ë¶€ë¶„ ë° ì¡°ê±´ì„ ë¯¸ë¦¬ ì¤€ë¹„í•œ ìì› ë° ì½”ë“œ 
- ì˜ˆë¥¼ ë“¤ì–´ 10ì¤„ì˜ row dataë¥¼ testí•  ë•Œ ì‚¬ìš©í•œë‹¤ ë¼ê³  í•˜ë©´ ì´ 10ì¤„ì´ fixtureê°€ ë¨
- ìœ„ì— ì½”ë“œë¥¼ ë³´ë©´ ê·¸ëŸ¼ file_nameì´ë¼ëŠ” tableì´ fixtureì— í•´ë‹¹ë¨

[ë³¸ë¬¸](https://testdriven.io/blog/modern-tdd/)ì—ì„œ test_quries.py ì½”ë“œë¥¼ ë³µì‚¬í•´ ì‚¬ìš©í•œë‹¤. <br>


## Flask API
ìš°ì„  í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ Flaskë¥¼ ì„¤ì¹˜í•œë‹¤.
```shell
pip install jsonschema Flask
``` 

ë³¸ë¬¸ì—ì„œ Articleê³¼ ArticleList json schema, test_app.py, test_app.pyë¥¼ ë³µì‚¬í•´ ì‚¬ìš©í•œë‹¤. <br>
json schemaë¥¼ ë”°ë¡œ ì •ì˜í•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì•Œê²Œë˜ì—ˆë‹¤. <br>

ì•„ë˜ì²˜ëŸ¼ bad requestì— ëŒ€í•´ì„œë„ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ì•¼í•œë‹¤. 
```python
def test_create_article_bad_request(client, data):
    """
    GIVEN request data with invalid values or missing attributes
    WHEN endpoint /create-article/ is called
    THEN it should return status 400
    """
    response = client.post(
        "/create-article/",
        data=json.dumps(
            data
        ),
        content_type="application/json",
    )

    assert response.status_code == 400
    assert response.json is not None
```

ë³¸ë¬¸ì—ì„œ ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ parmetrizeë¼ëŠ” ì–´ë…¸í…Œì´í„° ê°€ ìˆë‹¤. ì´ë¥¼ ì´ìš©í•˜ë©´ ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 

```python
@pytest.mark.parametrize(
    "data",
    [
        {
            "author": "John Doe",
            "title": "New Article",
            "content": "Some extra awesome content"
        },
        {
            "author": "John Doe",
            "title": "New Article",
        },
        {
            "author": "John Doe",
            "title": None,
            "content": "Some extra awesome content"
        }
    ]
)
```

app.pyì—ì„œë„ ì—ëŸ¬ í•¸ë“¤ëŸ¬ë¼ëŠ” ì–´ë…¸í…Œì´í„°ë¥¼ ì´ìš©í•˜ì—¬ í•¸ë“¤ë§ì´ ê°€ëŠ¥í•˜ë‹¤.<br>
ê¸°ëŠ¥ ì„¤ê³„ë„ ë¶„ëª… ì¤‘ìš”í•˜ì§€ë§Œ ì´ëŸ¬í•œ ì—ëŸ¬í•¸ë“¤ë§ì´ ê°œì¸ì ìœ¼ë¡œ ë” ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°ëœë‹¤.. ë¹µë¹µ í„°ì§€ëŠ”ê±¸ ë„ˆë¬´ ë§ì´ ê²½í—˜í•´ë´ì„œ..
```python
@app.errorhandler(ValidationError)
def handle_validation_exception(error):
    response = jsonify(error.errors())
    response.status_code = 400
    return response

```



## REFERENCES
[https://velog.io/@sangyeon217/pytest-fixture](https://velog.io/@sangyeon217/pytest-fixture)
[https://twpower.github.io/19-about-python-test-fixture](https://twpower.github.io/19-about-python-test-fixture)
