---
layout: post
title: kubernetes ì ìš©í•˜ê¸° 1
subtitle: kebernates ê°œë… ì•Œì•„ë³´ê¸°
author: weejw
categories: Data Pipeline

tags: [ì¿ ë²„ë„¤í‹°ìŠ¤, kubernetes, MLOps, docker, cloud, devOps, container]
---

## ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ ë­ì•¼?

```ì¿ ë²„ë„¤í‹°ìŠ¤``` ëŠ” container ì˜¤ì¼€ì´ìŠ¤íŠ¸ë ˆì´ì…˜ í”Œë«í¼ìœ¼ë¡œ í˜„ì¬ëŠ” ì‚¬ì‹¤ìƒ í‘œì¤€ì²˜ëŸ¼ ì‚¬ìš©ëœë‹¤. ì—¬ëŸ¬ëŒ€ì˜ ì„œë²„ê°€ ì¡´ì¬í•˜ëŠ” í´ëŸ¬ìŠ¤í„°ì—ì„œ container ê´€ë¦¬ë¥¼ ìœ„í•´ ì‚¬ìš©ëœë‹¤.
[ê³µì‹ í™ˆí˜ì´ì§€](https://kubernetes.io/ko/docs/concepts/overview/what-is-kubernetes/) ì— ë”°ë¥´ë©´ 
"ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” containerí™”ëœ ì›Œí¬ë¡œë“œì™€ ì„œë¹„ìŠ¤ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ì´ì‹ì„±ì´ ìˆê³ , í™•ì¥ê°€ëŠ¥í•œ ì˜¤í”ˆì†ŒìŠ¤ í”Œë«í¼ì´ë‹¤" ë¼ê³  ì„¤ëª…í•˜ê³  ìˆë‹¤.  

## ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ ì™œ í•„ìš”í–ˆì„ê¹Œ?

![](https://d33wubrfki0l68.cloudfront.net/26a177ede4d7b032362289c6fccd448fc4a91174/eb693/images/docs/container_evolution.svg)
ì¶œì²˜ [https://kubernetes.io/ko/docs/concepts/overview/what-is-kubernetes/](https://kubernetes.io/ko/docs/concepts/overview/what-is-kubernetes/)  

ì´ˆê¸°ì—ëŠ” í•˜ë‚˜ì˜ ë¬¼ë¦¬ì  ì„œë²„ì— ëª¨ë“  applicationì„ ì‹¤í–‰í–ˆë‹¤. ìƒì‹ì ìœ¼ë¡œ,, applicationì´ ì•„ë¬´ë¦¬ ê°€ë³ë‹¤í•´ë„ í˜¼ì ì“°ëŠ” TODO List ê°™ì€ê²Œ ì•„ë‹Œ ì´ìƒ ì´ëŠ” ê°ë‹¹ì´ ì•ˆëœë‹¤. 

ì´ë•Œë¬¸ì— ë“±ì¥í•œ ê²ƒì´ `ê°€ìƒí™”` ì˜€ë‹¤. í•˜ë‚˜ì˜ í˜¸ìŠ¤íŠ¸ì— VMì„ ì—¬ëŸ¬ê°œ ë„ì–´ì„œ applicationì„ ê²©ë¦¬ ì‹œí‚¨ê²ƒì´ë‹¤. ì´ ë•Œ VMì€ í•˜ë‚˜ì˜ OSìì²´ë¥¼ ê°€ìƒí™”ì‹œì¼°ë‹¤.  
os ìì²´ë¥¼ ê°€ìƒí™” ì‹œí‚¤ê³  ìˆê¸°ë•Œë¬¸ì—,, êµ‰ì¥íˆ ë¬´ê²ë‹¤. ë•Œë¬¸ì— ë“±ì¥í•œ ê²ƒì´ `container` ê°œë…ì´ë‹¤. Hostì˜ OSë¥¼ ê³µìœ í•œë‹¤.

ê·¸ë¦¬ê³  ì´ `containerë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ ë“±ì¥í–ˆë‹¤.`

## ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ì£¼ìš” ê°œë…

### 1. Object
ê°€ì¥ ê¸°ë³¸ì ì¸ êµ¬ì„±ë‹¨ìœ„ë¡œ OjbectëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì—”í‹°í‹°ì´ë‹¤. OjbectëŠ” Specê³¼ Statusë¥¼ ê°€ì§€ê³  ìˆë‹¤. <br>
Pod, Service, Volume, Namespace 4ê°€ì§€ê°€ ì¡´ì¬í•œë‹¤.
- Pod: ì»¨í…Œì´ë„ˆí™”ëœ ì–´í”Œë¦¬ì¼€ì´ì…˜
- Service: load balancer, ê³¼ë„í•œ íŠ¸ë˜í”½ì´ ë°œìƒí•˜ëŠ” ìƒí™©ì—ì„œ ì—¬ëŸ¬ ëŒ€ì˜ ì„œë²„ê°€ ë¶„ì‚°ì²˜ë¦¬í•˜ì—¬ ì´ë¥¼ í•´ê²°í•˜ëŠ” ì„œë¹„ìŠ¤<br> ServiceëŠ” label selectorë¥¼ ê°€ì§„ë‹¤. ì´ëŠ” Podì—ì„œ Metadataì— Labelì„ ì„¤ì •í•´ì¤„ ìˆ˜ ìˆëŠ”ë°, íŠ¹ì • Labelì„ ê°€ì§„ Podë§Œ ì„ íƒí•˜ì—¬ Serviceí•  ìˆ˜ ìˆë‹¤.
  - Labelì€ ë¦¬ì†ŒìŠ¤ ì„ íƒ ì‹œ ì‚¬ìš©ëœë‹¤. íŠ¹ì • ë¦¬ì†ŒìŠ¤ ë°°í¬ ë˜ëŠ” serviceì— í•´ë‹¹ labelì„ ë¶€ì—¬í•  ìˆ˜ ìˆë‹¤. 
  ```
    "metadata":{
      "label_k":"data",
      "label_k_n":"data_n"
    }
  ```
- Volume: Disk, ì˜ì†ì ìœ¼ë¡œ ì €ì¥ë˜ì–´ì•¼ í•˜ëŠ” ë°ì´í„°ì˜ ê²½ìš° ë³¼ë¥¨ì„ ë§ˆìš´íŠ¸í•´ì„œ ì´ìš©í•´ì•¼í•œë‹¤. 
- Namespace: pakage name, í´ëŸ¬ìŠ¤í„° ë‚´ì˜ ë…¼ë¦¬ì  ë¶„ë¦¬ ë‹¨ìœ„(ë¬¼ë¦¬ì  ë¶„ë¦¬ê°€ ì•„ë‹˜!!) ë¡œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë³„ë¡œ ë¦¬ì†ŒìŠ¤ë¥¼ ë‚˜ëˆ  ê´€ë¦¬í•  ìˆ˜ ìˆê³ , ì‚¬ìš©ìì˜ ê¶Œí•œì„ ë‹¤ë¥´ê²Œ í•  ìˆ˜ë„ ìˆë‹¤. 
 
### 2. Controller
Objectì˜ Statusë¥¼ ì‚¬ìš©ìê°€ ì›í•˜ëŠ” í˜•íƒœ(Desired State)ë¡œ Current Stateë¥¼ ë³€ê²½ì‹œì¼œì£¼ëŠ” ì£¼ì²´
>`Desired State`  <span style="color:red">â˜…â˜… ì™„ì „ ì¤‘ìš” â˜…â˜…</span><br><br>
ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” Desired Stateê°€ ì¤‘ìš”í•˜ë‹¤. ì´ëŠ” applicationì˜ ìµœì¢… ë°°í¬ ìƒíƒœë¥¼ ì˜ë¯¸í•œë‹¤. ì‚¬ìš©ìê°€ ì›í•˜ëŠ” stateë¥¼ ì•Œë ¤ì£¼ë©´ ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì‘ì—…ì„ í†µí•´ stateë¥¼ ë³€ê²½í•œë‹¤. ~~ì¿ ë²„ë„¤í‹°ìŠ¤ ë‚˜ë¥¼ ê³ ê¸‰ê°œë°œìë¡œ ì„¤ì •í•´ì¤˜~~  
ì´ ë•Œ, controller ì— ì˜í•´ stateê°€ ë³€ê²½ë˜ëŠ”ë°, control-loopë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§ì„ ì§„í–‰í•œë‹¤. control-loopëŠ” `Observe -> check Differeneces -> Take Action` ì˜ ìˆœì„œë¡œ loopë¥¼ ëˆë‹¤.

ê·¸ëŸ¼ ì—¬ê¸°ì„œ ë§í•˜ëŠ” stateê°€ ë­˜ê¹Œ?
ë‚´ê°€ ì›í•˜ëŠ” ì›¹ì„œë²„, í¬íŠ¸, ë¦¬ì†ŒìŠ¤ ë“±ì„ ì˜ë¯¸í•œë‹¤. ì„¤ì •í•˜ëŠ” ë°©ë²•ì€ YAMLì´ë‚˜ JSONì„ ì´ìš©í•  ìˆ˜ ìˆë‹¤. í•´ë‹¹ íŒŒì¼ì— applicationì˜ ìƒíƒœë¥¼ ëª…ì‹œí•˜ë©´ ì´ë¥¼ ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ ë³´ê³  ì•Œì•„ì„œ í•´ì¤€ë‹¤ëŠ” ê²ƒ! ìš°ì™€~ğŸ˜š

<br>[ì¿ ë²„ë„¤í‹°ìŠ¤ ê³µì‹ í˜ì´ì§€ ì„¤ëª…](https://kubernetes.io/ko/docs/concepts/workloads/controllers/) ì—ì„œ ì•„ë˜ ì¢…ë¥˜ì— ê´€í•´ ìì„¸í•˜ê²Œ í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤.
- Replication Controller: Pod ê´€ë¦¬, Podê°€ ë„ˆë¬´ ë§ìœ¼ë©´ ì œê±°í•˜ê³  ë„ˆë¬´ ì ìœ¼ë©´ Podë¥¼ ì‹œì‘í•œë‹¤. 
- Replicaset: Replica Pod setì˜ ì‹¤í–‰ì„ í•­ìƒ ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€í•´ì¤Œ Replication Controllerì™€ ë¹„ìŠ·í•˜ê²Œ Podì„ ê´€ë¦¬í•˜ëŠ”ë°, controllerëŠ” Equalityê¸°ë°˜ Selectorë¥¼ ì‚¬ìš©í•˜ëŠ” ë°˜ë©´ Replicasetì€ Setê¸°ë°˜ Selectorë¥¼ ì‚¬ìš©í•œë‹¤.
  - equalityëŠ” a=b, setê¸°ë°˜ì€ a in (prod, dev) ì™€ ê°™ì´ selection ë°©ë²•ì´ ë‹¤ë¥´ë‹¤.
- DaemonSet: Nodeê°€ Podì˜ ì‚¬ë³¸ì„ ì‹¤í–‰í•˜ë„ë¡ í•¨, í´ëŸ¬ìŠ¤í„° ìŠ¤í† ë¦¬ì§€ ë°ëª¬ ì‹¤í–‰, ë¡œê·¸ ìˆ˜ì§‘ ë°ëª¬ ì‹¤í–‰, ë…¸ë“œ ëª¨ë‹ˆí„°ë§ ë°ëª¬ ì‹¤í–‰ì´ ëŒ€í‘œì ì¸ ìš©ë„ì„ 
- Job: Jobì—ì„œ í•˜ë‚˜ ì´ìƒ Podë¥¼ ìƒì„±í•˜ê³  ì§€ì • ìˆ˜ì˜ Podê°€ ì„±ê³µì ìœ¼ë¡œ ì¢…ë£Œë  ë•Œê¹Œì§€ ì§€ì†í•´ì„œ ê´€ë¦¬
- StatefulSet: ë§ ê·¸ëŒ€ë¡œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ Statefulì„ ê´€ë¦¬í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” API
- Deployment: Podì™€ Replicasetì— ëŒ€í•œ ì„ ì–¸ì  ì—…ë°ì´íŠ¸ ì œê³µ 
  - Blue Green Deployment: Blue(old version) ---(traffic)-> Green(new version) 
  - ë¡¤ë§ ì—…ê·¸ë ˆì´ë“œ: Podë¥¼ í•˜ë‚˜ì”© ì˜®ê¹€ 



### 3. Pod
<bold>`ê°€ì¥ ì‘ì€ ë°°í¬ ë‹¨ìœ„`</bold> ì´ë‹¤.
ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì´ Podì„ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ Controllerë¥¼ í†µí•´ state manazementë¥¼ ì§„í–‰í•œë‹¤. ì¦‰, Podì˜ life cycleì„ ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ ê´€ë¦¬í•œë‹¤.  
- ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì»¨í…Œì´ë„ˆë¥¼ Pod ë‹¨ìœ„ë¡œ ë°°í¬í•œë‹¤. 
- 1ê°œì˜ Podì€ ì—¬ëŸ¬ê°œì˜ containerë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë‹¤. Podì€ ì´ <u>ë‚´ë¶€ containerì™€ id, port, volumne ë“±ì„ ê³µìœ í•˜ê³  localhost í†µì‹ ë„ ê°€ëŠ¥í•˜ë‹¤.</u>
- pauseë¼ëŠ” containerê°€ ë¨¼ì € ì‹¤í–‰ë˜ê³  ì´ contatinerì˜ namespaceë¥¼ pod ë‚´ì˜ containerê°€ ê³µìœ í•˜ëŠ” ê²ƒì´ë‹¤.
- Pod ë‹¨ìœ„ë¡œ ìŠ¤ì¼€ì¼ë§ì´ ì§„í–‰ëœë‹¤.
- 1ê°œì˜ Podì€ 1ê°œì˜ Nodeìœ„ì—ì„œ ì‹¤í–‰ë¨
- ReplicaSet Controllerì— ì˜í•´ ë³µì œ ìƒì„±ë  ìˆ˜ ìˆë‹¤.

Pod ìƒì„±ì„ ìš”ì²­í•˜ë©´ ì•„ë˜ ê³¼ì •ëŒ€ë¡œ íë¦„ì´ ì§„í–‰ëœë‹¤.   

![how things get done in ì¿ ë²„ë„¤í‹°ìŠ¤](https://miro.medium.com/max/700/1*WDJmiyarVfcsDp6X1-lLFQ.png)  
ì¶œì²˜ [https://blog.heptio.com/core-kubernetes-jazz-improv-over-orchestration-a7903ea92ca](https://blog.heptio.com/core-kubernetes-jazz-improv-over-orchestration-a7903ea92ca) 


## ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì–´ë–»ê²Œ ìƒê²¼ì„ê¹Œ?

ê³µì‹í™ˆí˜ì´ì§€ì—ì„œ ì œê³µí•˜ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ë‹¤. control(master) - node(worker:container ë°°í¬) í˜•íƒœì´ë‹¤.  
masterì—ëŠ” ë‹¤ì–‘í•œ ì»´í¬ë„ŒíŠ¸ê°€ ì¡´ì¬í•œë‹¤. 

![ì¿ ë²„ë„¤í‹°ìŠ¤ structure](https://d33wubrfki0l68.cloudfront.net/2475489eaf20163ec0f54ddc1d92aa8d4c87c96b/e7c81/images/docs/components-of-kubernetes.svg)
ì¶œì²˜ [https://kubernetes.io/ko/docs/concepts/overview/components/](https://kubernetes.io/ko/docs/concepts/overview/components/)

### Master
- kube-apiserver
ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ apië¥¼ ë‹¤ë¥¸ componentì—ê²Œ ì‘ë‹µí•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤. ê·¸ëŸ¬ë¯€ë¡œ clusterëŠ” ì´ api serverê°€ ì¤‘ì‹¬ì´ ë˜ì–´ í†µì‹ ì´ ë˜ëŠ” ê²ƒì´ë‹¤.

- etcd
ëª¨ë“  clusterì˜ dataë¥¼ ì €ì¥í•œë‹¤. key-value databaseë‹¤. 

- kube-schduler
ë…¸ë“œë“¤ì„ ëª¨ë‹ˆí„°ë§í•´ì„œ ìƒˆë¡œìš´ podë¥¼ ìƒì„±í•œë‹¤.

- kube-controller-manager
pod ê´€ë¦¬ ì»¨íŠ¸ë¡¤ëŸ¬

- colud-contoller-manager
ëª¨ë“  ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ cloud serviceì™€ ì—°ê²°í•´ì„œ managing.

### Worker
- kubelet(node manager)
clusterì˜ ê° nodeì—ì„œ ì‹¤í–‰ë˜ëŠ” `í•µì‹¬ ì»´í¬ë„ŒíŠ¸` ì œê³µëœ Specì„ í†µí•´ containerë¥¼ ì‹¤í–‰`ì‹œí‚¨ë‹¤`. ë˜í•œ, ì§€ì†ì ì¸ ëª¨ë‹ˆí„°ë§ê³¼ master nodeì™€ api server í†µì‹ ì„í•œë‹¤.  

- kube-proxy(network proxy)
ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ service objectë¥¼ êµ¬í˜„í•œë‹¤. nodeì˜ network ê·œì¹™ì„ ê´€ë¦¬í•œë‹¤.

- container runtime
`ì‹¤ì œë¡œ containerë¥¼ ì‹¤í–‰í•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´` 

## ì¿ ë²„ë„¤í‹°ìŠ¤ë¡œ ì •í™•íˆ ë­˜ í•  ìˆ˜ ìˆëŠ”ê±¸ê¹Œ!?

- ìë™í™”ëœ rolllout rollback 
- ìë™í™”ëœ bin packing: containerí™”ëœ ì‘ì—…ì„ ì‹¤í–‰í•˜ëŠ”ë° ì‚¬ìš© í•  ìˆ˜ ìˆëŠ” kube-cluser nodeë¥¼ ì œê³µí•œë‹¤. 
- ìë™í™”ëœ self-healing: ì‹¤íŒ¨í•œ ì»¨í…Œì´ë„ˆë¥¼ ë‹¤ì‹œ ì‹œì‘í•œë‹¤.  
ë“±.. ìì„¸í•œ ë‚´ìš©ì€ [https://kubernetes.io/ko/docs/concepts/overview/what-is-kubernetes/](https://kubernetes.io/ko/docs/concepts/overview/what-is-kubernetes/) ì—ì„œ ì¶”ê°€ë¡œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

## ì¿ ë²„ë„¤í‹°ìŠ¤ ë­ê°€ ì¢‹ê³  ë‚˜ì ê¹Œ?

ì™œ ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ ì‚¬ì‹¤ìƒ í‘œì¤€ì´ë¼ê³  í•  ì •ë„ë¡œ ì¢‹ì€ê±¸ê¹Œ?[ì´ ê¸€](http://www.opennaru.com/openshift/container/benefits-of-kubernetes/) ì—ì„œ ê¸°íšì/ ìš´ì˜ì/ ê°œë°œì ì¸¡ë©´ì—ì„œ ìì„¸í•˜ê²Œ ì •ë¦¬í•´ì£¼ì…¨ë‹¤.
ì „ì²´ì ìœ¼ë¡œ ë´¤ì„ ë• í™•ì¥ì„±, ìë™í™”, ì†ë„, ë¹„ìš© íš¨ìœ¨ì ì¸ ë©´ì´ í° ê²ƒê°™ë‹¤.

ë°˜ëŒ€ë¡œ [ì´ ê¸€](https://scoutapm.com/blog/kubernetes-advantages-disadvantages#h_70421613624971619649730428) ì—ì„œëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ë‹¨ì ì— ëŒ€í•´ì„œë„ ì´ì•¼ê¸°í•˜ê³  ìˆë‹¤.
ì¼ë‹¨ì€ ëŸ°ë‹ì»¤ë¸Œê°€ ë§¤ìš° í¬ë‹¤ëŠ” ì ì´ë‹¤. (ë‚˜ ë˜í•œ ì ˆì‹¤íˆ ëŠë¼ê³  ìˆë‹¤...ã… ã… ) ë‘ë²ˆì§¸ë¡œëŠ” ì†Œê·œëª¨ í”Œì ì—ì„œëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ ê·¸ë‹¥ ìœ ìš©í•˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤(ë¶ˆí•„ìš”í•œ ë³µì¡ì„±) 


## REFERENCES
[https://nesoy.github.io/articles/2018-06/Load-Balancer](https://nesoy.github.io/articles/2018-06/Load-Balancer)<br>
[https://theoriginalcatch.com/27](https://theoriginalcatch.com/27)<br>
[https://blog.2dal.com/2018/03/28/kubernetes-01-pod/](https://blog.2dal.com/2018/03/28/kubernetes-01-pod/)<br>
[https://kubernetes.io/ko/docs/concepts/overview/components/](https://kubernetes.io/ko/docs/concepts/overview/components/)  <br>
[https://tech.ktcloud.com/68](https://tech.ktcloud.com/68)  <br>
[https://subicura.com/ì¿ ë²„ë„¤í‹°ìŠ¤/guide/#minikube](https://subicura.com/ì¿ ë²„ë„¤í‹°ìŠ¤/guide/#minikube)  <br>
[https://velog.io/@gentledev10/install-minikube](https://velog.io/@gentledev10/install-minikube)<br>
